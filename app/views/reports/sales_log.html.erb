<style>
/* Professional Sales Log (page-scoped) */
.sales-page { max-width:1400px; margin:36px auto; padding:0 28px; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#0f172a }
.sl-header { display:flex; justify-content:space-between; align-items:center; gap:12px }
.sl-title { font-size:28px; margin:0; font-weight:700 }
.sl-sub { color:#475569; margin-top:6px }
.sl-grid { display:grid; grid-template-columns:repeat(12, 1fr); gap:28px; margin-top:28px }
.card { grid-column: span 12; background:#fff; border-radius:14px; padding:26px; box-shadow:0 14px 40px rgba(2,6,23,0.06); border:1px solid rgba(2,6,23,0.03) }
.metrics { display:grid; grid-template-columns:repeat(3,1fr); gap:22px }
.metric { padding:18px; border-radius:12px; background:linear-gradient(180deg,#ffffff,#fbfdff); text-align:left; border:1px solid #eef2ff; min-height:84px }
.metric .label { font-size:12px; color:#64748b }
.metric .value { font-size:20px; font-weight:700; color:#0b1220; margin-top:6px }
.metric .delta { font-size:12px; color:#10b981; margin-top:6px }
.panel { display:flex; gap:28px; margin-top:24px; align-items:flex-start }
.panel .left { flex:1 }
.panel .right { width:480px }
.top-table { width:100%; border-collapse:collapse; margin-top:12px }
.top-table thead th { text-align:left; font-size:13px; color:#334155; padding:12px 14px; border-bottom:1px solid #eef2ff }
.top-table tbody td { padding:12px 14px; border-bottom:1px solid #f8fafc }
.top-table tbody tr:nth-child(odd) { background: #ffffff }
.top-table tbody tr:nth-child(even) { background: #fbfdff }
.table-scroll { max-height:320px; overflow-y:auto; padding-right:6px; margin-top:8px }
.muted { color:#94a3b8 }
.range-form { display:flex; gap:8px; align-items:center }
.btn { padding:8px 12px; border-radius:8px; border:1px solid #e2e8f0; background:#fff; cursor:pointer }
.cta { background:#0ea5a4; color:#fff; border:none }
@media(max-width:1000px){ .metrics { grid-template-columns:repeat(2,1fr) } .panel { flex-direction:column } .panel .right { width:100% } }
</style>

<div class="sales-page">
  <div class="sl-header">
    <div>
      <h1 class="sl-title">Sales Log</h1>
      <div class="sl-sub">Overview of sales performance — use the custom range to drill down.</div>
    </div>
    <div style="text-align:right">
      <div style="font-size:13px;color:#64748b">Report generated</div>
      <div style="font-weight:600">As of <%= Time.now.in_time_zone('Asia/Kolkata').strftime('%Y-%m-%d %H:%M') %> IST</div>
    </div>
  </div>

  <div class="sl-grid">
  <div class="card" style="grid-column: span 8">
      <div class="metrics">
        <div class="metric">
          <div class="label">Today</div>
          <div class="value">₹<%= '%.2f' % (@today_total || 0) %></div>
        </div>
        <div class="metric">
          <div class="label">Yesterday</div>
          <div class="value">₹<%= '%.2f' % (@yesterday_total || 0) %></div>
        </div>
        <div class="metric">
          <div class="label">This Week</div>
          <div class="value">₹<%= '%.2f' % (@week_total || 0) %></div>
        </div>
        <div class="metric">
          <div class="label">This Month</div>
          <div class="value">₹<%= '%.2f' % (@month_total || 0) %></div>
        </div>
      </div>

      <div class="panel">
        <div class="left">
          <h3 style="margin:0">Top Items — This Week</h3>
          <div class="muted" style="margin-top:6px">Items ranked by quantity sold</div>

          <% if @top_items_week.any? %>
            <div class="table-scroll">
              <table class="top-table">
                <thead>
                  <tr><th>Item</th><th style="width:110px">Qty Sold</th><th style="width:140px">Sales Amount</th></tr>
                </thead>
                <tbody>
                  <% @top_items_week.each do |ti| %>
                    <tr>
                      <td><%= ti.name %></td>
                      <td style="font-weight:600;text-align:center"><%= ti.qty_sold %></td>
                      <td style="text-align:right">₹<%= '%.2f' % ti.sales_amount %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="muted" style="margin-top:8px">No items sold this week</div>
          <% end %>
        </div>

        <div class="right">
          <div class="card" style="padding:14px; margin:0">
            <h4 style="margin:0 0 6px 0">Yearly Total</h4>
            <div class="muted">Current fiscal year</div>
            <div style="font-weight:700;font-size:20px;margin-top:10px">₹<%= '%.2f' % (@year_total || 0) %></div>
          </div>

          <div class="card" style="padding:12px; margin:14px 0 0 0">
            <h4 style="margin:0 0 6px 0">Custom Range</h4>
            <form method="get" action="<%= sales_log_reports_path %>" class="range-form" style="margin-top:8px">
              <input type="date" name="from" value="<%= @custom_range ? @custom_range[0] : '' %>" />
              <input type="date" name="to" value="<%= @custom_range ? @custom_range[1] : '' %>" />
              <button class="btn cta" type="submit">Apply</button>
            </form>

            <% if defined?(@custom_total) && @custom_total %>
              <div style="margin-top:10px">Custom Total: <strong>₹<%= '%.2f' % @custom_total %></strong></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

  <div class="card" style="grid-column: span 4">
      <% if @custom_range %>
        <h3 style="margin:0">Top Items — Custom Range</h3>
        <div class="muted">(<%= @custom_range[0] %> → <%= @custom_range[1] %>)</div>
        <% if @top_items_custom && @top_items_custom.any? %>
          <table class="top-table" style="margin-top:10px">
            <thead>
              <tr><th>Item</th><th>Qty</th><th>Sales</th></tr>
            </thead>
            <tbody>
              <% @top_items_custom.each do |ti| %>
                <tr>
                  <td><%= ti.name %></td>
                  <td><%= ti.qty_sold %></td>
                  <td>₹<%= '%.2f' % ti.sales_amount %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <div class="muted" style="margin-top:8px">No items in this range</div>
        <% end %>
      <% else %>
        <h3 style="margin:0">Top Items — Custom Range</h3>
        <div class="muted" style="margin-top:6px">Pick a range to see item-wise performance</div>
      <% end %>
    </div>
  </div>
</div>
