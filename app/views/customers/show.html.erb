<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Customer â€¢ Orders</title>

  <style>
  :root {
    --bg: #f4f7fb;
    --card: #ffffff;
    --border: #e6edf5;
    --muted: #6b7280;
    --text: #111827;
    --primary: #2563eb;
    --accent: #eef4ff;
    --glass: linear-gradient(135deg, #eef4ff, #f9fbff);
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    background: var(--bg);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    color: var(--text);
  }

  /* PAGE */
  .cust-show {
    max-width: 1200px;
    margin: 26px auto;
    padding: 0 16px;
  }

  /* CARD */
  .cust-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 22px;
    box-shadow: 0 14px 40px rgba(16, 24, 40, 0.08);
  }

  /* HEADER */
  .cust-header {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 18px;
    align-items: center;
    padding-bottom: 18px;
    border-bottom: 1px solid var(--border);
  }

  .cust-avatar {
    width: 82px;
    height: 82px;
    border-radius: 18px;
    background: var(--glass);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 34px;
    box-shadow: inset 0 0 0 1px #dbe7ff;
  }

  .cust-name {
    font-size: 1.35rem;
    font-weight: 700;
  }

  .cust-contact {
    margin-top: 6px;
    font-size: 13px;
    color: var(--muted);
  }

  .cust-actions {
    display: flex;
    gap: 10px;
  }

  .btn {
    padding: 8px 14px;
    border-radius: 9px;
    border: 1px solid var(--border);
    background: #f9fbff;
    font-size: 13px;
    cursor: pointer;
    text-decoration: none;
    color: var(--text);
  }

  .btn.primary {
    background: var(--primary);
    color: #fff;
    border-color: var(--primary);
  }

  /* CUSTOMER DETAILS */
  .cust-details {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
    margin-top: 18px;
  }

  .detail-box {
    padding: 14px;
    border: 1px dashed #eef2f7;
    border-radius: 12px;
    background: #fbfdff;
  }

  .label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .05em;
    color: #374151;
  }

  .val {
    margin-top: 6px;
    font-size: 14px;
    line-height: 1.5;
  }

  /* ORDERS */
  .orders-section {
    margin-top: 26px;
  }

  .orders-head {
    display: flex;
    flex-direction: column; /* stack vertically */
    align-items: flex-start; /* left aligned */
    gap: 6px;
    margin-bottom: 12px;
  }

  .orders-title {
    font-weight: 700;
    font-size: 16px;
  }

  .tabs a {
    font-size: 13px;
    text-decoration: none;
    color: var(--muted);
    margin-right: 10px;
  }

  .tabs a.active {
    color: var(--primary);
    font-weight: 700;
  }

  /* TABLE */
  .orders-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    border-radius: 12px;
    overflow: hidden;
  }

  .orders-table th,
  .orders-table td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
    text-align: left;
    vertical-align: middle;
    white-space: nowrap;
  }

  .orders-table th {
    background: #f9fbff;
    font-weight: 700;
    color: #374151;
  }

  /* COLUMN WIDTHS â€“ FIXED */
  .orders-table th.order-col,
  .orders-table td.order-col { width: 80px; }

  .orders-table th.invoice,
  .orders-table td.invoice { width: 240px; }

  .orders-table th.date,
  .orders-table td.date { width: 140px; }

  .orders-table th.status,
  .orders-table td.status { width: 120px; }

  .orders-table th.num,
  .orders-table td.num {
    width: 140px;
    text-align: right;
    font-weight: 700;
  }

  .orders-table tr:hover td {
    background: #fafcff;
  }

  .muted {
    color: var(--muted);
    font-size: 12px;
  }

  @media (max-width: 980px) {
    .cust-details { grid-template-columns: 1fr 1fr; }
  }

  @media (max-width: 560px) {
    .cust-header { grid-template-columns: 1fr; text-align: center; }
    .cust-actions { justify-content: center; }
    .cust-details { grid-template-columns: 1fr; }
  }
  </style>
</head>

<body>

<div class="cust-show">
  <div class="cust-card">

    <!-- CUSTOMER HEADER -->
    <div class="cust-header">
      <div class="cust-avatar">ðŸ‘¤</div>

      <div>
        <div class="cust-name">
          <%= [@customer.first_name, @customer.last_name].reject(&:blank?).join(' ') %>
        </div>
        <div class="cust-contact">
          <%= @customer.email.presence || 'â€”' %> â€¢ <%= @customer.phone.presence || 'â€”' %>
        </div>
      </div>

      <div class="cust-actions">
        <%= link_to 'Back', customers_path, class: 'btn' %>
        <%= link_to 'New Order', new_order_path(customer_id: @customer.id), class: 'btn primary' %>
      </div>
    </div>

    <!-- CUSTOMER DETAILS -->
    <div class="cust-details">
      <div class="detail-box">
        <div class="label">Joined</div>
        <div class="val"><%= @customer.created_at.strftime('%b %d, %Y') %></div>
      </div>

      <div class="detail-box">
        <div class="label">Address</div>
        <div class="val"><%= @customer.address.presence || 'â€”' %></div>
      </div>

      <div class="detail-box">
        <div class="label">Aadhaar / PAN</div>
        <div class="val"><%= @customer.aadhaar_or_pan.presence || 'â€”' %></div>
      </div>

      <div class="detail-box">
        <div class="label">GST / Tax No</div>
        <div class="val"><%= @customer.gst_number.presence || 'â€”' %></div>
      </div>
    </div>

    <!-- ORDERS -->
    <div class="orders-section">
      <div class="orders-head">
        <div class="orders-title">Orders<br/></div>
        <div class="tabs">
          <%= link_to 'All', customer_path(@customer, tab: 'all'), class: (params[:tab].blank? || params[:tab] == 'all' ? 'active' : '') %>
          <%= link_to 'Paid', customer_path(@customer, tab: 'paid'), class: (params[:tab] == 'paid' ? 'active' : '') %>
          <%= link_to 'Pending', customer_path(@customer, tab: 'pending'), class: (params[:tab] == 'pending' ? 'active' : '') %>
        </div>
      </div>

      <% if @orders.any? %>
        <table class="orders-table">
          <thead>
            <tr>
              <th class="order-col">Order</th>
              <th class="invoice">Invoice</th>
              <th class="date">Date</th>
              <th class="status">Status</th>
              <th class="num">Total</th>
            </tr>
          </thead>
          <tbody>
            <% @orders.each do |o| %>
              <tr>
                <td class="order-col"><%= link_to "##{o.id}", order_path(o) %></td>
                <td class="invoice"><%= link_to(o.invoice_number.presence || 'N/A', invoice_order_path(o)) %></td>
                <td class="date muted"><%= o.sale_date || o.created_at.to_date %></td>
                <td class="status muted"><%= o.status.to_s.titleize %></td>
                <td class="num">
                  <% amt = (o.respond_to?(:total_cents_with_taxes_cached) ? (o.total_cents_with_taxes_cached.to_f/100.0) : 0) %>
                  â‚¹<%= '%.2f' % amt %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="muted">No orders found</div>
      <% end %>
    </div>

  </div>
</div>

</body>
</html>
