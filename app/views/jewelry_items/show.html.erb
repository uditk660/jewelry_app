<div class="container">
	<div class="product-hero card">
		<div class="product-grid">
			<div class="product-media">
				<%# placeholder avatar / image - replace with real uploads later %>
				<div class="product-image">üíç</div>
						<div class="product-actions">
							<%= button_tag 'Edit Item', type: 'button', class: 'btn btn-outline btn-sm', onclick: "window.location='#{edit_jewelry_item_path(@item)}'", aria: { label: "Edit #{@item.name}" } %>
							<%= button_tag 'Back to Catalog', type: 'button', class: 'btn btn-sm', onclick: "window.location='#{jewelry_items_path}'", aria: { label: 'Back to catalog' } %>
						</div>
			</div>

			<div class="product-details">
				<h1 class="product-title"><%= @item.name %></h1>
				<div class="product-meta small muted">SKU: <%= @item.sku %> ‚Ä¢ Category: <%= @item.jewellery_category.try(:name) || '‚Äî' %></div>
				<p class="product-desc"><%= simple_format(@item.description.to_s) %></p>

								<div class="product-pricing">
									<% per_gram = @item.effective_price_per_gram %>
									<% weight = (@item.weight_grams || 0).to_f %>
									<% qty = (@item.quantity.present? && @item.quantity.to_i > 0) ? @item.quantity.to_i : 1 %>
									<% unit_price = per_gram ? (per_gram * weight) : @item.price.to_f %>
									<% total_price = unit_price * qty %>

									<div class="price-large">
										<%= number_to_currency(unit_price, unit: '‚Çπ', precision: 2, delimiter: ',') %>
										<% if qty > 1 %>
											<div class="small muted">(each) ‚Äî total: <strong><%= number_to_currency(total_price, unit: '‚Çπ', precision: 2, delimiter: ',') %></strong></div>
										<% end %>
									</div>

									<% if per_gram.present? %>
										<% if @item.purity && @item.purity.updated_price.present? %>
											<div class="small muted">(calc: <%= number_to_currency(per_gram, unit: '‚Çπ', precision: 2) %> /g √ó <%= weight %> g √ó <%= qty %> = <%= number_to_currency(total_price, unit: '‚Çπ', precision: 2) %>) source: <%= @item.purity.name %></div>
										<% else %>
											<div class="small muted">(calc: <%= number_to_currency(per_gram, unit: '‚Çπ', precision: 2) %> /g √ó <%= weight %> g √ó <%= qty %> = <%= number_to_currency(total_price, unit: '‚Çπ', precision: 2) %>) source: metal stock</div>
										<% end %>
									<% end %>
					<div class="availability small muted">
						<% if @item.quantity.present? && @item.quantity > 0 %>
							In stock: <strong><%= @item.quantity %> pcs</strong>
						<% elsif @item.metal %>
							Metal stock available ‚Äî check stores below
						<% else %>
							Out of stock
						<% end %>
					</div>
				</div>

				<div class="product-attributes">
					<dl>
						<dt>Metal</dt><dd><%= @item.metal.try(:name) || '‚Äî' %></dd>
						<dt>Purity</dt><dd><%= @item.purity.try(:name) || '‚Äî' %></dd>
						<dt>Weight (g)</dt><dd><%= @item.weight_grams.to_f %> g</dd>
					</dl>
				</div>
			</div>
		</div>

		<% if @item.metal %>
			<div class="stock-breakdown muted small" style="margin-top:12px">
				<% stocks = MetalStock.where(metal: @item.metal) %>
				<strong>Store stock:</strong> <%= stocks.map{|s| "#{s.store.name}: #{s.available_grams}g"}.join(' | ').html_safe %>
			</div>
		<% end %>
	</div>
</div>
