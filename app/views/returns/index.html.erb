<style>
/* Returns index — compact professional UI (page-scoped) */
:root{--bg:#f6f8fb;--card:#fff;--border:#e6edf5;--muted:#6b7280;--text:#0f1724;--accent:#eef4ff;--primary:#2563eb}
.returns-page{max-width:1200px;margin:22px auto;padding:0 16px;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
.returns-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(16,24,40,0.04)}
.returns-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
.returns-title{font-size:1.25rem;font-weight:700;color:var(--text)}
.returns-sub{color:var(--muted);font-size:13px}
.returns-actions{display:flex;gap:10px;align-items:center}
.search-input{border:1px solid var(--border);padding:8px 10px;border-radius:8px;background:#fbfdff}
.btn.small{padding:6px 10px;font-size:13px}
.table-wrap{margin-top:14px;overflow:auto}
.returns-table{width:100%;border-collapse:collapse;font-size:13px}
.returns-table th,.returns-table td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left}
.returns-table th{background:#fbfdff;color:#374151;font-weight:600}
.muted{color:var(--muted)}
.tag{display:inline-block;padding:4px 8px;border-radius:999px;background:#f3f7ff;color:#2563eb;font-weight:600;font-size:12px}
.note{color:var(--muted);font-size:13px}
@media (max-width:800px){.returns-head{flex-direction:column;align-items:flex-start}.returns-actions{width:100%;justify-content:space-between}}
</style>

<div class="returns-page">
  <div class="returns-card">
    <div class="returns-head">
      <div>
        <div class="returns-title">Returns & Exchanges</div>
        <div class="returns-sub">Record refunds or exchanges and keep inventory in sync</div>
      </div>

      <div class="returns-actions">
        <%= link_to 'New Return / Exchange', new_return_path, class: 'btn primary' %>
        <input type="search" id="returns_search" class="search-input" placeholder="Search by customer, order, invoice or item" />
      </div>
    </div>

    <div class="table-wrap">
      <% if @records.any? %>
        <table class="returns-table">
          <thead>
            <tr>
              <th>When</th>
              <th>Customer</th>
              <th>Order</th>
              <th>Item (returned)</th>
              <th>Qty</th>
              <th>Action</th>
              <th class="muted">Amount</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @records.each_with_index do |r, i| %>
              <% item = (r['jewelry_item_id'].present? && JewelryItem.exists?(r['jewelry_item_id'])) ? JewelryItem.find(r['jewelry_item_id']) : nil %>
              <tr>
                <td class="muted"><%= r['created_at'].to_s(:db) rescue r['created_at'].to_s %></td>
                <td><%= r['customer_id'].presence || '—' %></td>
                <td><%= r['order_id'].presence || '—' %></td>
                <td><%= item ? (item.name + ' — ' + item.sku.to_s) : (r['jewelry_item_id'].presence || '—') %></td>
                <td><%= r['quantity'].presence || '—' %></td>
                <td><span class="tag"><%= r['action'].to_s.titleize %></span></td>
                <td class="muted"> <%= r['amount'].presence || '—' %></td>
                <td><%= link_to 'View', return_path(i), class: 'btn small' %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="note">No return records yet. Use "New Return / Exchange" to register a refund or exchange.</div>
      <% end %>
    </div>
  </div>
</div>
