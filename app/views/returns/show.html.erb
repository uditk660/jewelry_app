<style>
/* Returns ‚Äî professional show (page-scoped) */
:root{--bg:#f7f9fc;--card:#fff;--muted:#6b7280;--text:#0f1724;--accent:#eef4ff;--primary:#2563eb;--glass:linear-gradient(135deg,#eef4ff,#f9fbff)}
.return-page{max-width:980px;margin:28px auto;padding:0 16px;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
.return-card{background:var(--card);border:1px solid #e8f0f8;border-radius:14px;padding:22px;box-shadow:0 8px 30px rgba(16,24,40,0.04)}
.return-head{display:flex;justify-content:space-between;align-items:center;gap:16px}
.return-title{font-size:1.4rem;font-weight:700;color:var(--text)}
.return-sub{color:var(--muted);font-size:13px}
.chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--accent);color:var(--primary);font-weight:700}
.return-grid{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:16px}
.meta dt{font-size:12px;color:#374151;text-transform:uppercase;font-weight:700;margin-top:10px}
.meta dd{margin:4px 0 0;color:var(--text);font-size:15px}
.card-box{background:#fbfdff;border:1px solid #eef6ff;padding:12px;border-radius:10px}
.label{font-size:13px;color:#374151;font-weight:600}
.notes{background:#fff;border:1px solid #eef4ff;padding:10px;border-radius:8px;color:#111827;font-size:14px}
.actions{display:flex;gap:10px}
.btn.ghost{background:transparent;border:1px solid #e6edf5}
.item-head{display:flex;align-items:center;gap:12px}
.item-avatar{width:56px;height:56px;border-radius:8px;background:var(--glass);display:flex;align-items:center;justify-content:center;font-size:20px}
.muted{color:var(--muted)}
@media(max-width:800px){.return-grid{grid-template-columns:1fr}.actions{justify-content:flex-start}}
</style>

<div class="return-page">
  <div class="return-card">
    <div class="return-head">
      <div>
        <div class="return-title">Return / Exchange</div>
        <div class="return-sub">Review the return details and process the refund or exchange.</div>
      </div>

      <div class="actions">
        <%= link_to 'Print', '#', onclick: 'window.print();return false;', class: 'btn ghost' %>
        <%= link_to 'Back', returns_path, class: 'btn' %>
      </div>
    </div>

    <% if @record %>
      <div class="return-grid">
        <div>
          <div class="meta">
            <dt>Reference</dt>
            <dd><span class="chip">REF-<%= params[:id] %></span></dd>

            <dt>When</dt>
            <dd><%= @record['created_at'] %></dd>

            <dt>Customer</dt>
            <dd><%= @record['customer_id'].presence || '‚Äî' %></dd>

            <dt>Order / Invoice</dt>
            <dd><%= @record['order_id'].presence || '‚Äî' %></dd>

            <dt>Action</dt>
            <dd><%= @record['action'].to_s.titleize %></dd>

            <dt>Amount</dt>
            <dd><%= @record['amount'].presence || '‚Äî' %></dd>

            <dt>Weight (g)</dt>
            <dd><%= @record['weight'].present? ? ('%.3f' % @record['weight'].to_f) : '‚Äî' %></dd>

            <dt>Returning Rate (‚Çπ / g)</dt>
            <dd><%= @record['returning_rate'].present? ? ('‚Çπ' + ('%.2f' % @record['returning_rate'].to_f)) : '‚Äî' %></dd>

            <dt>Additional Costs (‚Çπ)</dt>
            <dd><%= @record['additional_costs'].present? ? ('‚Çπ' + ('%.2f' % @record['additional_costs'].to_f)) : '‚Äî' %></dd>
          </div>

          <div style="margin-top:14px">
            <div class="label">Reason</div>
            <div class="notes"><%= h(@record['reason']) %></div>
          </div>

          <div style="margin-top:12px">
            <div class="label">Staff Notes</div>
            <div class="notes"><%= h(@record['notes']) %></div>
          </div>
        </div>

        <aside>
          <div class="card-box">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="label">Returned Item</div>
              <div class="muted">Stock updated: <strong><%= @record['stock_updated'] ? 'Yes' : 'No' %></strong></div>
            </div>

            <div style="margin-top:10px">
              <% if @record['jewelry_item_id'].present? && JewelryItem.exists?(@record['jewelry_item_id']) %>
                <% ji = JewelryItem.find(@record['jewelry_item_id']) %>
                <div class="item-head">
                  <div class="item-avatar">üíç</div>
                  <div>
                    <div style="font-weight:700"><%= ji.name %></div>
                    <div class="muted">SKU: <%= ji.sku %></div>
                    <div style="margin-top:8px">Returned qty: <strong><%= @record['quantity'] %></strong></div>
                    <% if @record['weight'].present? %>
                      <div class="muted" style="margin-top:6px">Weight (per item): <strong><%= '%.3f' % @record['weight'].to_f %> g</strong></div>
                    <% end %>
                    <% if @record['returning_rate'].present? %>
                      <div class="muted" style="margin-top:4px">Returning Rate: <strong>‚Çπ<%= '%.2f' % @record['returning_rate'].to_f %></strong> /g</div>
                    <% end %>
                    <% if @record['additional_costs'].present? %>
                      <div class="muted" style="margin-top:4px">Additional Costs: <strong>‚Çπ<%= '%.2f' % @record['additional_costs'].to_f %></strong></div>
                    <% end %>
                  </div>
                </div>
                <div style="margin-top:12px" class="muted">Current stock: <strong><%= ji.quantity %></strong></div>
              <% else %>
                <div class="muted">No item specified</div>
              <% end %>
            </div>

            <div style="margin-top:16px;display:flex;gap:8px">
              <%= link_to 'Process Refund', '#', class: 'btn' %>
              <%= link_to 'Start Exchange', new_return_path(customer_id: @record['customer_id'], order_id: @record['order_id']), class: 'btn primary' %>
            </div>
          </div>

          <div style="margin-top:14px" class="card-box">
            <div class="label">Signature / Stamp</div>
            <div style="height:70px;border:1px dashed #eef4ff;border-radius:8px;margin-top:8px"></div>
          </div>
        </aside>
      </div>
    <% else %>
      <div class="muted">Record not found</div>
    <% end %>
  </div>
</div>
